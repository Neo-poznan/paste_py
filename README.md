# Проект paste.py 
Клон pastebin предназначен для создания текстовых постов. 
![alt text](textexample.png)
А еще тут есть онлайн интерпретатор python кода
![alt text](codeexample.png)

# Что за проект
Проект был сделан для обучения и демонстрации навыков работы с разными технологиями и отработать сложные сценарии.
Многие технические решения в проекте не стоило так усложнять, если бы речь зашла про реальный проект.
В случае с реальным проектом стоило бы сначала сделать все максимально просто, а потом уже оптимизировать по мере необходимости.
Например предварительна генерация ключей на фоне дает очень маленький выигрыш по производительности. В реальном проекте я бы для начала сделал рандомные ключи и каждый раз проверял бы отсутствие ключа базе данных. 


## Как работает
![alt text](projectscheme.png)

#### Сохранение нового поста
С клиента приходит новый пост. Под него достается из redis или генерируется короткий и уникальный ключ. С этим ключом метаданные поста сохраняются в базу данных. Текст поста сохраняется в s3 хранилище. 

#### Генерация ключей
Ключи генерируются на фоне. За это отвечает периодическая задача в celery. В настройках указывается сколько ключей должно быть предварительно сгенерировано и как часто нужно проверять ключи и в случае необходимости генерировать новые. 

Алгоритм генерации такой:
1. Достаем уникальное число из базы данных
2. Берем хеш от числа
3. Кодируем в url-safe base64
4. Обрезаем до желаемой длины 

#### Получение постов
Когда нужно получить пост, то достаем из базы данных метаданные и текст поста из файлового хранилища, после чего кэшируем текст на 30 минут.

#### Безопасное выполнение python-кода
В проекте есть онлайн-интерпретатор пользовательского кода.

Чтобы обезопасить сервер от выполнения вредоносного кода, под каждый запрос на выполнение кода создается отдельный контейнер. 

